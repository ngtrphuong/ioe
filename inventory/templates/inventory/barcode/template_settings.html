{% extends "inventory/base.html" %}
{% load static %}

{% block title %}Barcode Template Settings{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Barcode Template Settings</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Barcode Size & Style</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="barcode_width" class="form-label">Barcode Width (pixels)</label>
                                    <input type="number" class="form-control" id="barcode_width" name="barcode_width" value="{{ config.barcode_width }}" min="100" max="500">
                                    <div class="form-text">Recommended: 300</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="barcode_height" class="form-label">Barcode Height (pixels)</label>
                                    <input type="number" class="form-control" id="barcode_height" name="barcode_height" value="{{ config.barcode_height }}" min="50" max="300">
                                    <div class="form-text">Recommended: 100</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="barcode_font_size" class="form-label">Font Size (pixels)</label>
                                    <input type="number" class="form-control" id="barcode_font_size" name="barcode_font_size" value="{{ config.barcode_font_size }}" min="8" max="24">
                                    <div class="form-text">Recommended: 12</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Display Options</h6>
                            </div>
                            <div class="card-body">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="barcode_show_price" name="barcode_show_price" {% if config.barcode_show_price %}checked{% endif %}>
                                    <label class="form-check-label" for="barcode_show_price">Show Price</label>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="barcode_show_name" name="barcode_show_name" {% if config.barcode_show_name %}checked{% endif %}>
                                    <label class="form-check-label" for="barcode_show_name">Show Product Name</label>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="barcode_show_company" name="barcode_show_company" {% if config.barcode_show_company %}checked{% endif %}>
                                    <label class="form-check-label" for="barcode_show_company">Show Company Name</label>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="barcode_company_name" class="form-label">Company Name</label>
                                    <input type="text" class="form-control" id="barcode_company_name" name="barcode_company_name" value="{{ config.barcode_company_name|default:'' }}" maxlength="50">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Preview</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 offset-md-3">
                                        <div class="barcode-preview text-center p-3" style="border: 1px dashed #ccc;">
                                            <div class="mb-2">
                                                <img src="{% static 'img/barcode_sample.png' %}" alt="Barcode Sample" style="max-width: 100%; height: auto;">
                                            </div>
                                            <div id="preview-name" style="font-weight: bold;">Sample Product Name</div>
                                            <div id="preview-price">Â¥99.99</div>
                                            <div id="preview-company" style="font-size: 0.8rem; color: #666;">Sample Company Name</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between mt-4">
                    <a href="{% url 'generate_barcode' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Barcode Generation
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Update preview
        function updatePreview() {
            let showName = $('#barcode_show_name').is(':checked');
            let showPrice = $('#barcode_show_price').is(':checked');
            let showCompany = $('#barcode_show_company').is(':checked');
            let companyName = $('#barcode_company_name').val();
            let fontSize = $('#barcode_font_size').val() + 'px';
            
            $('#preview-name').toggle(showName);
            $('#preview-price').toggle(showPrice);
            $('#preview-company').toggle(showCompany);
            
            if (companyName) {
                $('#preview-company').text(companyName);
            }
            
            // Update font size
            $('#preview-name, #preview-price').css('font-size', fontSize);
            $('#preview-company').css('font-size', (parseInt(fontSize) * 0.8) + 'px');
        }
        
        // Bind events
        $('#barcode_show_name, #barcode_show_price, #barcode_show_company, #barcode_company_name, #barcode_font_size').on('change input', updatePreview);
        
        // Initialize preview
        updatePreview();
    });
</script>
{% endblock %}